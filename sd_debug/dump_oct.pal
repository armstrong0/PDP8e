/ this program reads disk sectors and output octal in the form
/ od -o -A none -N 1024 
    *  10 
Caddr, 0

    * 20 
    Kspace, 240 /040   Adding 200 to the values turn 8N1 into 7N2
    Kcr,   215 /015
    Klf,   212 /012
    Knuchr, 0
    Kbit7, 0200
    Kzero, 260 /0060
    M1,    -0001
    Km8,   -0010
    M10,   -0012
    zeroF, 0007
    
    Saddr, Sdata
    Eaddr, Edata
    Ctmp, 0
    Wcnt, 0
    Wline, -0010


    * 200 
    6040    // use SPF instead of print to the output uart
    JMS  CRLF   // start off print CR/LF 
    / calculate how many words we will output
    cla
    tad Eaddr
    cma iac / form 2's complemebnt
    tad Saddr
    dca Wcnt


    CLA
    TAD Saddr
    TAD M1 / autoindex pre-increments so back off by one
    DCA Caddr
Cloop,    TAD I Caddr  / get next word to process
    DCA  Ctmp        / save it away
    tad Kzero
    JMS PrintC
    7000
    tad Kzero
    JMS PrintC
    7000
    tad  Ctmp
    bsw 
    rtr
    rar
    jms octaldigit
    7000 /when debuging using simh it did not seem that the instruction
         /following the jms was not being executed, add 7000 nop it 
         / seemed to work leaving it
    tad Ctmp
    bsw
    jms octaldigit
    7000
    tad Ctmp
    rtr
    rar
    jms octaldigit
    7000
    tad Ctmp
    jms octaldigit
    7000
    isz Wline
    jmp Cloop2
    jmp eofline
Cloop2, jms PrintSp 
Cloop1, isz Wcnt
    jmp Cloop
    hlt
    
eofline, jms CRLF
    cla
    tad Km8
    dca Wline
    jmp Cloop1

octaldigit, 0
    and zeroF
    tad Kzero
    JMS PrintC
    cla
    JMS I octaldigit


/ number of words on a line 8
/ location to store current word to be printed
/ routine to print 3 hex digits followed by either a CR/LF or a space

/ space 40
/ 0 60
/ A 101
/ a 141

PrintSp, 0
    CLA
    TAD Kspace
    TSF
    JMP .-1
    TLS
    CLA
    JMP I PrintSp

/ routine to print a charactor
/ clear ac before exit
PrintC, 0
    LOOPC, TSF  / wait until the TTO is empty (flag set)
    JMP LOOPC
    TLS         / put char into TTO 
    CLA
    JMP I PrintC / return

/ routine to print a carrage return / line feed
CRLF, 0
    CLA
    TAD Kcr    / output a carrage return
    JMS PrintC
    TAD Klf
    JMS PrintC / output a linefeed
    JMP I CRLF

  *1000
  / TestData
/ generated with od -o -A none -N 1024 -w2 -v systemdisk.rk05 > 2sectors
/ 
Sdata,
 001412
 003413
 001414
 006211
 003415
 006201
 001013
 007640
 005000
 005437
 000177
 007577
 000046
 007646
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 006741
 005030
 000035
 003436
 005000
 000006
 000342
 007605
 007326
 006751
 006211
 004053
 003417
 005044
 000000
 007607
 007607
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 006202
 004207
 001000
 000000
 000007
 007746
 006203
 005677
 000400
 000000
 003340
 006214
 001275
 003336
 006201
 001674
 007010
 006211
 007630
 005321
 006202
 004207
 005010
 000000
 000027
 007402
 006202
 004207
 000610
 000000
 000013
 007602
 005020
 006202
 004207
 001010
 000000
 000027
 007402
 000000
 005700
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 000000
 004230
 004230
 002010
 004250
 004250
 004230
 004230
 004230
 004230
 000000
 001040
 000000
 000000
 000000
 000000
 000000
 004207
 005000
 000000
 000033
 007602
 006213
 005267
 000003
 007300
 001207
 003221
 005224
 006260
 004070
 003700
 006202
 000037
 000003
 007200
 001214
 003207
 007346
 003351
 006214
 001217
 003337
 001221
 003221
 001621
 000215
 001342
 003353
 001621
 002221
 000216
 007450
 007330
 003352
 001621
 002221
 006744
 001621
 007100
 001207
 003350
 007430
 002353
 003354
 001352
 000335
 007650
 001341
 001354
 007112
 001353
 006746
 001350
 006743
 006741
 005272
 006745
 007104
 007640
 005317
 007410
 007402
 001352
 001335
 007550
 005334
 003352
 001350
 007040
 000220
 007640
 007130
 002350
 005257
 005256
 006742
 007126
 006742
 006741
 005322
 006742
 006745
 007640
 005324
 007344
 002351
 005232
 005336
 002221
 007600
 002221
 007402
 005621
 000400
 000000
 001764
 006203
 000200
 000000
 000000
 007750
 007751
 007752
 007753
 007754
 007755
 007607
 004756
 003700
 000000
 001453
 007402
 005372
 004207
 000300
 007000
 000035
 007402
 006203
 006042
 005775
 000200
 000000
 000010
 007737
 000070
 000002
 001412
 007777
 000225
 001114
 000400
 002326
 000000
 007737
 000102
 002314
 000422
 002326
 003017
 007773
 000211
 002415
 000120
 002326
 000000
 007773
 000217
 001724
 000000
 002326
 000601
 007773
 000303
 001400
 000000
 002326
 000000
 007756
 000322
 000506
 000000
 002326
 000000
 007763
 000411
 002205
 000324
 002326
 000000
 007771
 000504
 001124
 000000
 002326
 003113
 007766
 000520
 001103
 000000
 002326
 000000
 007762
 000602
 001717
 002400
 002326
 001746
 007776
 000617
 002420
 000000
 002326
 000000
 007770
 001005
 001420
 000000
 001014
 000000
 007711
 001005
 001420
 000000
 002326
 000000
 007770
 002001
 001470
 000000
 002326
 000000
 007755
 002011
 002000
 000000
 002326
 000000
 007765
 002024
 007005
 000000
 000216
 003457
 007777
 002205
 002317
 002203
 002326
 000000
 007766
 002230
 000317
 002031
 002326
 000000
 007772
 002301
 000222
 000000
 002326
 000000
 007750
 002405
 000317
 000000
 002326
 000000
 007752
 000201
 002311
 000300
 000106
 000000
 007774
 000201
 002311
 000300
 000606
 000000
 007774
 000201
 002311
 000300
 002306
 000000
 007774
 000201
 002311
 000300
 002326
 000000
 007767
 000201
 002311
 000300
 002506
 000000
 007774
 000203
 001715
 002000
 002326
 000000
 007757
 000214
 001701
 000400
 002326
 000000
 007770
 000222
 002423
 000000
 002326
 000000
 007761
 000501
 000222
 002423
 000216
 000000
 007750
 002205
 002305
 002100
 000201
 000000
 007772
 000503
 001017
 000000
 002326
 000000
 007776
 002213
 001406
 001524
 002326
 003457
 007767
 002305
 002400
 000000
 002326
 000000
 007762
 001104
 002300
 000000
 002326
 000000
 007773
 000664
 000000
 000000
 002326
 003657
 007754
 002001
 002323
 006200
 002326
 003657
 007754
 002001
 002323
 006260
 002326
 003657
 007773
 002001
 002323
 006300
 002326
 003657
 007770
 000000
 002562
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
 003047
 005752
Edata,0 
/Sdata,  0022 /0000 0001 0010 012 
/    1505     /0011 0100 0101 345    
/    3170     /0110 0111 1000 678
/    4653     /1001 1010 1011 9ab
/    6336     /1100 1101 1110 cde
/    7401     /1111 0000 0001 f01
/    0000 /should produce 0..9 abcdef
/    0001
/    0002
/    0003
/    0004
/    0005
/    0006
/    0007
/    0010
/    0011
/    0012
/    0013
/    0014
/    0015
/    0016
/    0017
/    7777
/EData, 0


$
